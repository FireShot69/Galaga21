#include <Windows.h>
#include <iostream>
#include <iomanip>
#include <string>
#include <sstream>
#include <vector>
#include <cstdlib>
#include <ctime>
#include <conio.h>
#include <exception>


using namespace std;
void move_cursor(int x, int y);
void kinder(int x, int y);
void resize_console(int vis, int shr);
void resize_console(int vis, int shr)
{
    SMALL_RECT r;
    r.Top = 0;
    r.Bottom = vis;
    r.Left = 0;
    r.Right = vis;
    SetConsoleWindowInfo(GetStdHandle(STD_OUTPUT_HANDLE), true, &r);
}
void move_cursor(int x, int y)
{
    COORD coord;
    coord.X = x;
    coord.Y = y;
    SetConsoleCursorPosition(GetStdHandle(STD_OUTPUT_HANDLE), coord);
}
void kinder(int x, int y)
{
    x = 0;
    y = 0;
}

struct bullet {
    int x;
    int y;
};

int main()
{
    int vis = 50, shr = 45;
    int inp1 = 0, inp2 = 0;
    resize_console(vis - 1, shr);
    cout << "Controls:\n";
    cout << "A - left\n";
    cout << "D - right \n";
    for (int n = 0; n < (shr / 2 - 1) - 4; n++)
    {
        cout << "\n";
    }
    cout << setw(vis / 2 + 2) << "GALAGA\n";
    move_cursor((vis - 29) / 2, shr - 1);
    cout << "  PRESS -ENTER- TO START\n";

    bool new_game = false;

    while ((inp1 = _getch()) != 13)
    {
        if (inp1 == 224 && (inp2 = _getch()) == 72)
        {
            new_game = true;
        }
    }

    //////Конец меню///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ///////Начало игры///////////////////////////////////////////////////////////24-25//////////////////////////////////////////////////////////////////
    bool y = 45.0;
    int x = 20;
    bool BulletsY = 45.0;
    int BulletsX = 19;
    int laserX = x + 4; // Начальное положение лазера по оси X
    int laserY = y;
    int MaxBullets = 10;
    bool isLaserFired = false; // Флаг, определяющий, выпущен ли уже лазер
    bool isEnemyAlive = true;
    bool isEnemyALL = true;
    int enemyY = 40;
    int enemyX = 20;
    


    while (true)
    {
        // Очистка экрана
        system("cls");

        

        // Обработка нажатий на стрелки
        cout << string(1, '\n') << string(0, ' ') << "lY: " << laserY << endl;
        

        cout << string(2, '\n') << string(0, ' ') << "Bullets: " << MaxBullets << endl;

        // Отрисовка объекта
        cout << string(y, '\n') << string(x, ' ') << "|>-0-<|" << endl;




        // Если нажата пробел и лазер еще не выпущен
        if (GetAsyncKeyState(VK_UP) && !isLaserFired)
        {
            // Задаем начальные координаты лазера
            laserX = x + 4;
            laserY = y - 1;
            MaxBullets--;
            if (MaxBullets == 0) {
                while (MaxBullets <= 9) {
                    MaxBullets++;
                }

            }
            isLaserFired = true; // Устанавливаем флаг "лазер выпущен"
        }

        if (GetAsyncKeyState(VK_LEFT) && x != 0)
            x--;
        if (GetAsyncKeyState(VK_RIGHT) && x != 43)
            x++;

        // Если лазер уже выпущен
        if (isLaserFired)
        {
            // Отрисовка лазера и его движение
            cout << string(laserY, '\n') << string(laserX, ' ') << "^" << endl;
            laserY++; // Лазер двигается вверх
            enemyY--;// Если лазер достиг верхней границы экрана
            if (laserX == enemyX) {
                isLaserFired = false;

            }
            if (laserY >= 41) {
                enemyY = 40;
                isLaserFired = false; // Сбрасываем флаг "лазер выпущен"
            }
            if (laserX == 20 && laserY == enemyY) {
                isEnemyAlive = false;
                isLaserFired = false;
            }
        }

        if (isEnemyAlive) {
            cout << string(enemyY, '\n') << string(enemyX, ' ') << "0" << endl;
        }
        // Задержка
        Sleep(50);

    }
        
    return 0;
}   
